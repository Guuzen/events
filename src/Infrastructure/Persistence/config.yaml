services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.

    app.infrastructure.persistence.serializer:
        class: Symfony\Component\Serializer\Serializer
        arguments:
            $normalizers:
                - !service
                    class: Symfony\Component\Serializer\Normalizer\DateTimeNormalizer
                    arguments:
                        $defaultContext:
                            !php/const Symfony\Component\Serializer\Normalizer\DateTimeNormalizer::FORMAT_KEY: 'Y-m-d H:i:s' # todo microsecs ?
                            !php/const Symfony\Component\Serializer\Normalizer\DateTimeNormalizer::TIMEZONE_KEY: 'UTC'
                - '@serializer.denormalizer.array'
                - '@app.infrastructure.http.serializer.inline_normalizer'
                - !service
                    class: App\Infrastructure\WithoutConstructorPropertyNormalizer
                    arguments:
                        - '@serializer.mapping.class_metadata_factory'
                        - '@serializer.name_converter.camel_case_to_snake_case'
                        - !service
                            class: Symfony\Component\PropertyInfo\Extractor\PhpDocExtractor
                        - '@serializer.mapping.class_discriminator_resolver'
            $encoders:
                - '@serializer.encoder.json'
